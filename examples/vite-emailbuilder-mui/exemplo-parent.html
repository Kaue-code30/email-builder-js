<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exemplo - Parent com Email Builder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    .controls {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    button {
      background: #0066FF;
      color: white;
      border: none;
      padding: 12px 24px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #0052CC;
    }
    button.secondary {
      background: #6c757d;
    }
    button.secondary:hover {
      background: #5a6268;
    }
    #status {
      margin-top: 15px;
      padding: 12px;
      background: #fff;
      border-left: 4px solid #0066FF;
      border-radius: 4px;
    }
    iframe {
      width: 100%;
      height: 800px;
      border: 2px solid #ddd;
      border-radius: 8px;
    }
    h1 {
      margin-top: 0;
      color: #333;
    }
    .info {
      color: #666;
      font-size: 14px;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé® Email Builder - Integra√ß√£o Parent</h1>
    <p class="info">
      Exemplo de como carregar HTML do banco de dados no iframe e receber o HTML editado.
    </p>

    <div class="controls">
      <div>
        <button id="loadSimple">üìß Carregar Email Simples</button>
        <button id="loadFromDB">üíæ Simular Carregar do Banco</button>
        <button id="saveHTML" class="secondary">üíæ Salvar HTML</button>
        <button id="showHTML" class="secondary">üëÅÔ∏è Ver HTML</button>
      </div>
      <div id="status">Aguardando HTML do editor...</div>
    </div>

    <iframe 
      id="email-editor-frame" 
      src="http://localhost:5173"
      title="Email Builder"
    ></iframe>
  </div>

  <script>
    let currentHTML = '';

    // ========================================
    // 1. RECEBER HTML DO IFRAME (em tempo real)
    // ========================================
    window.addEventListener('message', (event) => {
      // Em produ√ß√£o, valide o origin:
      // if (event.origin !== 'http://localhost:5173') return;
      
      if (event.data.type === 'EMAIL_HTML') {
        currentHTML = event.data.html;
        const size = (currentHTML.length / 1024).toFixed(2);
        document.getElementById('status').innerHTML = 
          `‚úÖ <strong>HTML atualizado:</strong> ${size} KB`;
      }
    });

    // ========================================
    // 2. ENVIAR HTML PARA O IFRAME
    // ========================================
    function enviarHTMLParaIframe(html) {
      const iframe = document.getElementById('email-editor-frame');
      
      iframe.contentWindow.postMessage({
        type: 'LOAD_EMAIL_HTML',
        html: html
      }, '*');
      
      document.getElementById('status').innerHTML = 
        '‚úÖ <strong>HTML carregado no editor!</strong>';
    }

    // ========================================
    // EXEMPLO 1: Email Simples (ser√° convertido em blocos)
    // ========================================
    document.getElementById('loadSimple').addEventListener('click', () => {
      const htmlSimples = `
        <h1 style="color: #0066FF; font-family: Arial, sans-serif; text-align: center;">
          Ol√° Mundo!
        </h1>
        <p style="color: #333; font-family: Arial, sans-serif; font-size: 16px; line-height: 1.5;">
          Este HTML ser√° automaticamente convertido em blocos edit√°veis: Heading, Text e Button.
        </p>
        <a href="https://example.com" 
           style="display: inline-block;
                  background-color: #0066FF;
                  color: white;
                  padding: 12px 24px;
                  text-decoration: none;
                  border-radius: 5px;
                  font-family: Arial, sans-serif;">
          Clique Aqui
        </a>
        <hr style="margin: 20px 0; border: 1px solid #ddd;" />
        <img src="https://via.placeholder.com/600x200" 
             alt="Imagem de exemplo" 
             style="width: 100%; max-width: 600px;" />
      `;
      
      enviarHTMLParaIframe(htmlSimples);
    });

    // ========================================
    // EXEMPLO 2: Simular carregar do banco (estrutura complexa)
    // ========================================
    document.getElementById('loadFromDB').addEventListener('click', async () => {
      // HTML complexo ser√° parseado em m√∫ltiplos blocos
      const htmlDoBanco = `
        <div style="background-color: #f5f5f5; padding: 40px;">
          <div style="background-color: #ffffff; padding: 40px; max-width: 600px; margin: 0 auto;">
            <h1 style="color: #333; font-size: 32px; margin: 0 0 20px 0; font-family: Arial, sans-serif; text-align: center;">
              Email do Banco de Dados
            </h1>
            <p style="color: #666; font-size: 18px; line-height: 1.6; margin: 0 0 30px 0; font-family: Arial, sans-serif; text-align: center;">
              Este HTML complexo ser√° convertido automaticamente em blocos visuais edit√°veis!
            </p>
            <div style="text-align: center;">
              <a href="https://example.com" 
                 style="display: inline-block;
                        padding: 16px 40px;
                        background-color: #0066FF;
                        color: #ffffff;
                        text-decoration: none;
                        font-size: 16px;
                        font-weight: bold;
                        font-family: Arial, sans-serif;
                        border-radius: 5px;">
                Come√ßar Agora
              </a>
            </div>
            <hr style="margin: 30px 0; border: none; border-top: 1px solid #ddd;" />
            <p style="color: #999; font-size: 14px; margin: 0; font-family: Arial, sans-serif; text-align: center;">
              ¬© 2026 Sua Empresa. Todos os direitos reservados.
            </p>
          </div>
        </div>
      `;
      
      enviarHTMLParaIframe(htmlDoBanco);
    });

    // ========================================
    // 3. SALVAR HTML NO BANCO
    // ========================================
    document.getElementById('saveHTML').addEventListener('click', async () => {
      if (!currentHTML) {
        alert('‚ùå Nenhum HTML dispon√≠vel ainda. Aguarde o editor carregar.');
        return;
      }
      
      console.log('üì§ Salvando HTML no banco...');
      console.log(currentHTML);
      
      // Em produ√ß√£o, voc√™ faria:
      /*
      try {
        const response = await fetch('/api/emails/save', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            emailId: 123,
            html: currentHTML
          })
        });
        
        const data = await response.json();
        alert('‚úÖ HTML salvo no banco com sucesso!');
        document.getElementById('status').innerHTML = 
          '‚úÖ <strong>HTML salvo no banco!</strong>';
      } catch (error) {
        alert('‚ùå Erro ao salvar: ' + error.message);
      }
      */
      
      alert('‚úÖ HTML salvo! (veja o console para ver o conte√∫do)');
      document.getElementById('status').innerHTML = 
        '‚úÖ <strong>HTML salvo no banco de dados!</strong>';
    });

    // ========================================
    // 4. VISUALIZAR HTML
    // ========================================
    document.getElementById('showHTML').addEventListener('click', () => {
      if (!currentHTML) {
        alert('‚ùå Nenhum HTML dispon√≠vel ainda.');
        return;
      }
      
      // Abre em nova janela para visualizar
      const newWindow = window.open('', '_blank');
      newWindow.document.write(currentHTML);
      newWindow.document.close();
    });

    // ========================================
    // AUTO-SAVE (opcional)
    // ========================================
    let saveTimeout;
    
    window.addEventListener('message', (event) => {
      if (event.data.type === 'EMAIL_HTML') {
        currentHTML = event.data.html;
        
        // Cancela o timer anterior
        clearTimeout(saveTimeout);
        
        // Auto-save ap√≥s 3 segundos de inatividade
        saveTimeout = setTimeout(() => {
          console.log('üíæ Auto-salvando...');
          // Aqui voc√™ chamaria a API de save
        }, 3000);
      }
    });
  </script>
</body>
</html>
